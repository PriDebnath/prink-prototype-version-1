<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini Miro ‚Äî Sticky Notes + Selection</title>
  <style>
    :root{--bg:#f3f6fb}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif}
    .app{height:100vh;display:flex}

    /* Sidebar */
    .sidebar{width:60px;background:#fff;border-right:1px solid #e6e9ef;display:flex;flex-direction:column;align-items:center;padding:8px 0;gap:10px}
    .tool-btn{width:44px;height:44px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:1px solid #ddd;background:#fafafa}
    .tool-btn.active{border:2px solid #2563eb;background:#e8f0fe}

    /* Board */
    .board{position:relative;flex:1;background:linear-gradient(180deg,var(--bg),#fff);overflow:hidden}

    /* Sticky note */
    .note{
      position:absolute;
      min-width:120px;min-height:100px;
      padding:10px;border-radius:8px;
      box-shadow:0 8px 20px rgba(16,24,40,0.08);
      user-select:text;cursor:grab;transform-origin:left top;
      display:flex;flex-direction:column;gap:8px;overflow:auto;resize: both;
    }
    .note:active{cursor:grabbing}
    .note .header{display:flex;justify-content:space-between;align-items:center}
    .note .content{flex:1;outline:none;white-space:pre-wrap}

    /* colors */
    .yellow{background:#fff9c4}

    /* selection */
    .note.selected{box-shadow:0 10px 28px rgba(37,99,235,0.18);border:2px solid rgba(37,99,235,0.85)}
    .marquee{position:absolute;border:2px dashed rgba(34,34,34,0.25);background:rgba(37,99,235,0.06);pointer-events:none}

  </style>
</head>
<body>
  <div class="app">
    <div class="sidebar">
      <div class="tool-btn active" id="tool-sticky" title="Sticky Note">üìù</div>
      <div class="tool-btn" id="tool-select" title="Select">üî≤</div>
    </div>
    <div id="board" class="board"></div>
  </div>

  <script>
    (function(){
      const board = document.getElementById('board');
      const boardRect = board.getBoundingClientRect();

      const stickyTool = document.getElementById('tool-sticky');
      const selectTool = document.getElementById('tool-select');
      let currentTool = 'sticky';

      let notes = new Map(); // id -> element
      let idCounter = 1;
      let selected = new Set();

      // Marquee selection
      let marquee = null;
      let marqueeStart = null;

      function setTool(tool){
        currentTool = tool;
        [stickyTool,selectTool].forEach(btn=>btn.classList.remove('active'));
        if(tool==='sticky') stickyTool.classList.add('active');
        if(tool==='select') selectTool.classList.add('active');
      }

      stickyTool.onclick=()=>setTool('sticky');
      selectTool.onclick=()=>setTool('select');

      function createNote(x=40,y=40, color='yellow', text=''){
        const id = 'n'+(idCounter++);
        const el = document.createElement('div');
        el.className = 'note '+color;
        el.style.left = x+'px'; el.style.top = y+'px';
        // el.style.width = '180px';
        el.setAttribute('data-id', id);
        el.innerHTML = `
          <div class="header" style="font-weight:600;font-size:13px">Sticky</div>
          <div class="content" contenteditable="false">${text || 'Double-click to edit...'}</div>
        `;

        board.appendChild(el);
        notes.set(id, el);

        el.addEventListener('mousedown', notePointerDown);
        el.addEventListener('dblclick', (e)=>{
          const content = el.querySelector('.content');
          content.contentEditable = 'true';
          content.focus();
        });
        el.querySelector('.content').addEventListener('blur',()=>{
          el.querySelector('.content').contentEditable = 'false';
        });

        return id;
      }

      function clearSelection(){
        selected.forEach(id=>{
          const el = notes.get(id); if(el) el.classList.remove('selected');
        });
        selected.clear();
      }

      function selectNote(id, toggle=false){
        const el = notes.get(id); if(!el) return;
        if(toggle){
          if(selected.has(id)){ selected.delete(id); el.classList.remove('selected'); }
          else { selected.add(id); el.classList.add('selected'); }
        } else {
          selected.add(id); el.classList.add('selected');
        }
      }

      // note drag / group drag
      let dragging = null;

      function notePointerDown(e){
        if(currentTool!=='select') return;
        const note = e.currentTarget;
        const id = note.getAttribute('data-id');

        if(e.shiftKey){ selectNote(id, true); }
        else if(!selected.has(id)) { clearSelection(); selectNote(id); }

        const startX = e.clientX, startY = e.clientY;
        const selectedPositions = {};
        selected.forEach(sid=>{
          const el = notes.get(sid);
          selectedPositions[sid] = {left: parseFloat(el.style.left), top: parseFloat(el.style.top)};
        });

        dragging = {startX,startY,selectedPositions};

        function onMove(ev){
          const dx = ev.clientX - dragging.startX;
          const dy = ev.clientY - dragging.startY;
          for(const sid of selected){
            const el = notes.get(sid);
            const p = dragging.selectedPositions[sid];
            el.style.left = (p.left + dx) + 'px';
            el.style.top = (p.top + dy) + 'px';
          }
        }
        function onUp(){
          dragging = null;
          window.removeEventListener('mousemove', onMove);
          window.removeEventListener('mouseup', onUp);
        }
        window.addEventListener('mousemove', onMove);
        window.addEventListener('mouseup', onUp);
        e.stopPropagation();
      }

      // board interactions
      board.addEventListener('mousedown', (e)=>{
        if(currentTool==='sticky'){
          if(e.target===board){
            createNote(e.offsetX, e.offsetY,'yellow','New note');
          }
        } else if(currentTool==='select'){
          if(e.target===board){
            const currentX = e.clientX 
const currentY = e.clientY 

            marqueeStart = {x: currentX, y: currentY};
            marquee = document.createElement('div');
            marquee.className = 'marquee';
            marquee.style.left = marqueeStart.x - board.getBoundingClientRect().left + 'px';
            marquee.style.top = marqueeStart.y - board.getBoundingClientRect().top + 'px';
            board.appendChild(marquee);

            function onMove(ev){
              const x = Math.min(ev.clientX, marqueeStart.x);
              const y = Math.min(ev.clientY, marqueeStart.y);
              const w = Math.abs(ev.clientX - marqueeStart.x);
              const h = Math.abs(ev.clientY - marqueeStart.y);
              marquee.style.left = (x - board.getBoundingClientRect().left) + 'px';
              marquee.style.top = (y - board.getBoundingClientRect().top) + 'px';
              marquee.style.width = w + 'px';
              marquee.style.height = h + 'px';

              const mRect = {left:x-board.getBoundingClientRect().left,top:y-board.getBoundingClientRect().top,right:x-board.getBoundingClientRect().left+w,bottom:y-board.getBoundingClientRect().top+h};
              notes.forEach((el,id)=>{
                const r = el.getBoundingClientRect();
                const rb = board.getBoundingClientRect();
                const rect = {left:r.left-rb.left,top:r.top-rb.top,right:r.right-rb.left,bottom:r.bottom-rb.top};
                if(!(rect.left>mRect.right||rect.right<mRect.left||rect.top>mRect.bottom||rect.bottom<mRect.top)){
                  el.classList.add('selected'); selected.add(id);
                } else { el.classList.remove('selected'); selected.delete(id); }
              });
            }
            function onUp(){
              marquee.remove(); marquee=null; marqueeStart=null;
              window.removeEventListener('mousemove', onMove);
              window.removeEventListener('mouseup', onUp);
            }
            window.addEventListener('mousemove', onMove);
            window.addEventListener('mouseup', onUp);
          }
        }
      });

      // init
      createNote(80,80,'yellow','Sticky Note');
    })();
  </script>
</body>
</html>
