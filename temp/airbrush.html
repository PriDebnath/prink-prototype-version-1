<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ibisPaint X-Style Airbrush ðŸ’¨</title>
  <style>
    body {
      margin: 0;
      background: #f3f4f6;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      font-family: sans-serif;
      user-select: none;
      touch-action: none;
    }
    canvas {
      border: 2px solid #aaa;
      border-radius: 10px;
      background: #fff;
      touch-action: none;
    }
    .toolbar {
      margin-top: 14px;
      display: flex;
      gap: 12px;
    }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      background: #2563eb;
      color: white;
      transition: 0.2s;
    }
    button.clear { background: #e11d48; }
    button.active { background: #10b981; }
  </style>
</head>
<body>
  <canvas id="paint" width="500" height="400"></canvas>

  <div class="toolbar">
    <button id="modeBtn">Mode: Draw ðŸŽ¨</button>
    <button id="clearBtn" class="clear">Clear ðŸ§½</button>
  </div>

  <script>
    const canvas = document.getElementById("paint");
    const ctx = canvas.getContext("2d");
    const modeBtn = document.getElementById("modeBtn");
    const clearBtn = document.getElementById("clearBtn");

    // === Airbrush Parameters ===
    let drawing = false;
    let eraseMode = false;
    let mouse = { x: 0, y: 0 };
    let lastStampTime = 0;

    const brushRadius = 40;       // Circle size
    const brushOpacity = 0.18;    // Max opacity at center
    const spacing = 12;           // Distance between soft circle stamps (controls smoothness)
    const color = "#2563eb";      // Brush color

    // === Helper: Convert hex to RGBA string ===
    function colorWithAlpha(hex, alpha) {
      const bigint = parseInt(hex.replace("#", ""), 16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    // === Draw soft circular gradient ===
    function drawSoftCircle(x, y, radius, color, opacity) {
      const grad = ctx.createRadialGradient(x, y, 0, x, y, radius);
      grad.addColorStop(0, colorWithAlpha(color, opacity)); // center strong
      grad.addColorStop(1, colorWithAlpha(color, 0));       // edge fades out

      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.arc(x, y, radius, 0, Math.PI * 2);
      ctx.fill();
    }

    // === Get mouse or touch position ===
    function getPos(e) {
      const rect = canvas.getBoundingClientRect();
      const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
      const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
      return { x, y };
    }

    // === Start drawing ===
    function start(e) {
      drawing = true;
      mouse = getPos(e);
      lastStampTime = 0;
      ctx.globalCompositeOperation = eraseMode ? "destination-out" : "source-over";
      drawSoftCircle(mouse.x, mouse.y, brushRadius, color, brushOpacity);
    }

    // === Stop drawing ===
    function stop() {
      drawing = false;
    }

    // === On move: Stamp soft circles spaced along path ===
    function move(e) {
      if (!drawing) return;
      const pos = getPos(e);
      const dx = pos.x - mouse.x;
      const dy = pos.y - mouse.y;
      const dist = Math.hypot(dx, dy);

      // Stamp circles every few pixels (based on spacing)
      if (dist > spacing) {
        const steps = Math.floor(dist / spacing);
        for (let i = 0; i < steps; i++) {
          const t = i / steps;
          const x = mouse.x + dx * t;
          const y = mouse.y + dy * t;
          drawSoftCircle(x, y, brushRadius, color, brushOpacity);
        }
        mouse = pos;
      }
    }

    // === Toggle Draw/Erase ===
    modeBtn.onclick = () => {
      eraseMode = !eraseMode;
      modeBtn.textContent = eraseMode ? "Mode: Erase ðŸ©¹" : "Mode: Draw ðŸŽ¨";
      modeBtn.classList.toggle("active", eraseMode);
    };

    // === Clear Canvas ===
    clearBtn.onclick = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    };

    // === Events ===
    canvas.addEventListener("mousedown", start);
    canvas.addEventListener("mousemove", move);
    canvas.addEventListener("mouseup", stop);
    canvas.addEventListener("mouseleave", stop);

    canvas.addEventListener("touchstart", start);
    canvas.addEventListener("touchmove", move);
    canvas.addEventListener("touchend", stop);
  </script>
</body>
</html>
